<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>CÄ°O MOTORS Ä°lan OluÅŸturucu</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
body{
    font-family: Arial, Helvetica, sans-serif;
    background:#eaeaea;
    padding:20px;
}

.app{
    display:flex;
    gap:20px;
    max-width:1500px;
    margin:auto;
}

/* SOL PANEL */
.panel-sol{
    width:35%;
    background:#fff;
    padding:20px;
    border-radius:6px;
}

input, textarea{
    width:100%;
    padding:8px;
    margin-bottom:8px;
    box-sizing:border-box;
}

button{
    padding:10px 18px;
    margin-right:6px;
    cursor:pointer;
}

/* SAÄž PANEL */
.panel-sag{
    width:65%;
    background:#f5f5f5;
    padding:10px;
    overflow:auto;
}

#ilan{
    width:100%;
}

/* Ä°LAN */
.banner img{
    width:100%;
    display:block;
}

.siyah-baslik{
    background:#000;
    color:#fff;
    text-align:center;
    padding:18px;
    font-size:14px;
    font-weight:bold;
    border-bottom:10px solid #fff;
}

.alt-baslik{
    background:#000;
    color:#fff;
    text-align:center;
    padding:14px;
    font-size:13px;
    margin-top:1px;
}

.icerik{
    text-align:center;
    padding:10px;
    line-height:2;
    font-size:14px;
}

.uyari{
    background:#000;
    color:#94eb63;
    text-align:center;
    padding:18px;
    font-weight:bold;
}

.kayit{
    padding:6px 8px;
    border-bottom:1px solid #ddd;
    cursor:pointer;
}
.kayit:hover{
    background:#f0f0f0;
}
</style>
</head>

<body>

<div class="app">

<!-- SOL -->
<div class="panel-sol">

<h3>Ä°lan Bilgileri</h3>

<input id="baslikInput" placeholder="AraÃ§ BaÅŸlÄ±ÄŸÄ±" oninput="canli()">

<textarea id="disInput" rows="8" placeholder="AraÃ§ DÄ±ÅŸ TasarÄ±m" oninput="canli()"></textarea>
<textarea id="icInput" rows="8" placeholder="AraÃ§ Ä°Ã§ TasarÄ±m" oninput="canli()"></textarea>
<textarea id="guvenlikInput" rows="4" placeholder="GÃ¼venlik ve Asistan DonanÄ±mlarÄ±" oninput="canli()"></textarea>
<textarea id="ekstraInput" rows="4" placeholder="Ekstra DonanÄ±mlar" oninput="canli()"></textarea>
<textarea id="eksperInput" rows="4" placeholder="Eksper Durumu" oninput="canli()"></textarea>

<button onclick="resmiYukle()">ðŸ–¼ GÃ¶rsel OluÅŸtur & YÃ¼kle</button>

<h4>OluÅŸan GÃ¶rsel Linki</h4>
<input id="sonLink" readonly>

<hr>

<h4>KayÄ±tlÄ± Ä°lanlar</h4>
<input id="aramaInput" placeholder="BaÅŸlÄ±ÄŸa gÃ¶re ara..." oninput="listele()">
<div id="liste"></div>

</div>

<!-- SAÄž -->
<div class="panel-sag">

<div id="ilan">

    <div class="banner">
        <img src="img/showroom.png" crossorigin="anonymous">
    </div>

    <div class="siyah-baslik" id="baslik"></div>

    <div id="disBlok">
        <div class="alt-baslik">DIÅž TASARIM</div>
        <div class="icerik" id="dis"></div>
    </div>

    <div id="icBlok">
        <div class="alt-baslik">Ä°Ã‡ TASARIM</div>
        <div class="icerik" id="ic"></div>
    </div>

    <div id="guvenlikBlok">
        <div class="alt-baslik">GÃœVENLÄ°K VE ASÄ°STAN</div>
        <div class="icerik" id="guvenlik"></div>
    </div>

    <div id="ekstraBlok">
        <div class="alt-baslik">EKSTRA DONANIMLAR</div>
        <div class="icerik" id="ekstra"></div>
    </div>

    <div id="eksperBlok">
        <div class="alt-baslik">EKSPER DURUMU</div>
        <div class="icerik" id="eksper"></div>
    </div>

    <div class="uyari">GAYRÄ°MENKUL TAKASI TEKLÄ°F ETMEYÄ°NÄ°Z !</div>

    <div class="banner">
        <img src="img/footer.png" crossorigin="anonymous">
    </div>

</div>
</div>
</div>

<script>
/* CLOUDINARY */
const CLOUD_NAME = "dhoyvlfcj";
const UPLOAD_PRESET = "cio_upload";
let sonGorsel = "";

/* CANLI */
function canli(){
    baslik.innerText = baslikInput.value;

    blokYonet(disInput, dis, disBlok);
    blokYonet(icInput, ic, icBlok);
    blokYonet(guvenlikInput, guvenlik, guvenlikBlok);
    blokYonet(ekstraInput, ekstra, ekstraBlok);
    blokYonet(eksperInput, eksper, eksperBlok);
}

function blokYonet(input, hedef, blok){
    let deger = input.value.trim();
    if(deger === ""){
        blok.style.display = "none";
        hedef.innerHTML = "";
    }else{
        blok.style.display = "block";
        hedef.innerHTML = duzenle(deger);
    }
}

function duzenle(t){
    return t.split("\n").map(s=>s.trim()).filter(Boolean).join("<br>");
}

/* GÃ–RSEL OLUÅžTUR + YÃœKLE */
function resmiYukle(){
    const ilan = document.getElementById("ilan");
    const scale = 1080 / ilan.offsetWidth;

    html2canvas(ilan,{
        scale:scale,
        useCORS:true,
        backgroundColor:"#fff"
    }).then(canvas=>{
        canvas.toBlob(blob=>{
            let fd = new FormData();
            fd.append("file", blob);
            fd.append("upload_preset", UPLOAD_PRESET);
            fd.append("folder", "ilanlar");

            fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,{
                method:"POST",
                body:fd
            })
            .then(r=>r.json())
            .then(d=>{
                sonGorsel = d.secure_url;
                sonLink.value = d.secure_url;
                kaydet();
                window.open(d.secure_url,"_blank");
            });
        },"image/jpeg",0.92);
    });
}

/* KAYDET */
function kaydet(){
    let ilan = {
        id:Date.now(),
        baslik:baslikInput.value,
        dis:disInput.value,
        ic:icInput.value,
        guvenlik:guvenlikInput.value,
        ekstra:ekstraInput.value,
        eksper:eksperInput.value,
        gorsel:sonGorsel
    };

    let liste = JSON.parse(localStorage.getItem("cio_ilanlar")||"[]");
    liste.unshift(ilan);
    localStorage.setItem("cio_ilanlar",JSON.stringify(liste));
    listele();
}

/* LÄ°STELE */
function listele(){
    let arama = aramaInput.value.toLowerCase();
    let liste = JSON.parse(localStorage.getItem("cio_ilanlar")||"[]");
    let alan = document.getElementById("liste");
    alan.innerHTML = "";

    liste.filter(i=>i.baslik.toLowerCase().includes(arama)).forEach((i,index)=>{
        let d = document.createElement("div");
        d.className = "kayit";
        d.innerText = i.baslik;
        d.onclick = ()=>yukle(i);
        d.oncontextmenu = e=>{
            e.preventDefault();
            if(confirm("Silinsin mi?")){
                liste.splice(index,1);
                localStorage.setItem("cio_ilanlar",JSON.stringify(liste));
                listele();
            }
        };
        alan.appendChild(d);
    });
}

/* YÃœKLE */
function yukle(i){
    baslikInput.value = i.baslik;
    disInput.value = i.dis || "";
    icInput.value = i.ic || "";
    guvenlikInput.value = i.guvenlik || "";
    ekstraInput.value = i.ekstra || "";
    eksperInput.value = i.eksper || "";
    sonLink.value = i.gorsel || "";
    sonGorsel = i.gorsel || "";
    canli();
}

listele();
</script>

</body>
</html>
