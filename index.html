<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>CÄ°O MOTORS Ä°lan OluÅŸturucu</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
body{
    font-family: Arial, Helvetica, sans-serif;
    background:#eaeaea;
    padding:20px;
}

.app{
    display:flex;
    gap:20px;
    max-width:1500px;
    margin:auto;
}

/* SOL PANEL */
.panel-sol{
    width:35%;
    background:#fff;
    padding:20px;
    border-radius:6px;
}

input, textarea, select{
    width:100%;
    padding:8px;
    margin-bottom:8px;
    box-sizing:border-box;
}

button{
    padding:10px 18px;
    margin-right:6px;
    cursor:pointer;
}

/* SAÄž PANEL */
.panel-sag{
    width:65%;
    background:#f5f5f5;
    padding:10px;
    overflow:auto;
}

#ilan-wrapper{
    display:flex;
    justify-content:center;
}

#ilan{
    width:100%;
    transform-origin: top center;
    transition: transform 0.15s ease;
}

/* Ä°LAN */


.banner img{
    width:100%;
    display:block;
}

.siyah-baslik{
    background:#000;
    color:#fff;
    text-align:center;
    padding:18px;
    font-size:14px;
    font-weight:bold;
    border-bottom:10px solid #fff; /* kalÄ±n beyaz Ã§izgi */
}


.alt-baslik{
    background:#000;
    color:#fff;
    text-align:center;
    padding:18px;
    font-size:14px;
    margin-top:1px;
}

.icerik{
    text-align:center;
    padding:10px;
    line-height:2;
    font-size:14px;
}

.uyari{
    background:#000;
    color:#94eb63;
    text-align:center;
    padding:18px;
    font-weight:bold;
}

.kayit{
    padding:6px 8px;
    border-bottom:1px solid #ddd;
    cursor:pointer;
}
.kayit:hover{
    background:#f0f0f0;
}


.kategori{
    margin-bottom:14px;
}

.kategori-baslik{
        background:#d1d1d1;

    font-weight:bold;
    margin-bottom:6px;
    text-align:center;
    font-size:18px;
}

.ozellik-item{
    padding:4px 0;
    cursor:grab;
}

.ozellik-item.dragging{
    opacity:0.4;
}


</style>
</head>

<body>

<div class="app">

<!-- SOL -->
<div class="panel-sol">

<h3>Ä°lan Bilgileri</h3>

<input id="baslikInput" placeholder="AraÃ§ BaÅŸlÄ±ÄŸÄ±" oninput="canli()">

<textarea id="ozellikInput" rows="10" placeholder="AraÃ§ Ã¶zellikleri" oninput="canli()"></textarea>

<textarea id="eksperInput" rows="5" placeholder="Eksper durumu" oninput="canli()"></textarea>

<button onclick="resmiYukle()">ðŸ–¼ Resmi YÃ¼kle </button>

<h4>Resim Linki Burada</h4>

<input id="sonLink" placeholder="GÃ¶rsel linki" readonly>

<hr>

<h4>KayÄ±tlÄ± Ä°lanlar</h4>

<input 
    id="aramaInput" 
    placeholder="BaÅŸlÄ±ÄŸa gÃ¶re ara..." 
    oninput="listele()">

<div id="liste"></div>


</div>

<!-- SAÄž -->
<div class="panel-sag">

<div id="ilan">

    <div class="banner">
        <img src="img/showroom.png" crossorigin="anonymous">
    </div>

    <div class="siyah-baslik" id="baslik"></div>

    <div class="alt-baslik">ARAÃ‡ Ã–ZELLÄ°KLERÄ°</div>
    <div class="icerik" id="ozellikler"></div>

    <div class="alt-baslik">EKSPER DURUMU</div>
    <div class="icerik" id="eksper"></div>

    <div class="uyari">GAYRÄ°MENKUL TAKASI TEKLÄ°F ETMEYÄ°NÄ°Z !</div>

    <div class="banner">
        <img src="img/footer.png" crossorigin="anonymous">
    </div>

</div>

</div>
</div>

<script>
/* CLOUDINARY */
const CLOUD_NAME = "dhoyvlfcj";
const UPLOAD_PRESET = "cio_upload";
let sonGorsel = "";

/* TÃœRKÃ‡E BÃœYÃœK HARF */
function buyukTR(metin){
    return metin.toLocaleUpperCase("tr-TR");
}

/* ANAHTAR KELÄ°MEYE GÃ–RE GRUP */
function gruplandir(satir){

    const dis = [
        "PANAROMÄ°K","LED","AYNA","CAM","FAR","JANT","LASTÄ°K","TAVAN","SPOLIER"
    ];

    const ic = [
        "KOLTUK","KLÄ°MA","AMBÄ°YANS","BAGAJ",
        "KOL DAYAMA","KOLTUK","YÃœKSEKLÄ°K","DERÄ°","DÃ–ÅžEME","ISITMA","SOÄžUTMA"
    ];

    const guvenlik = [
        "FREN","GÃœVENLÄ°K","Ã‡ARPIÅžMA","YAYA","KORUMA",
    ];

    const surus = [
        "ASÄ°ST","360","NAVÄ°GASYON",
        "HIZ","ÅžERÄ°T","KÃ–R","YORGUNLUK","YOKUÅž","START","SABÄ°T","LÄ°MÄ°TÃ–R",
        "YAÄžMUR SENSÃ–RÃœ","FAR SENSÃ–RÃœ","HEAD","LAUNCH","AIR","PARK","HOLD","HOLDER","CRUISE","F1","SÃœRÃœÅž","ANAHTAR"
    ];

    const teknoloji = [
        "APPLE","BLUETOOTH","CAR PLAY","ÅžARJ","BLUETOOTH","TV","SES","HARMAN","BANG","BOSE","BURMESTER","EKRAN","AUX","CONNECT","EÄžLENCE","BOWER","KABLOSUZ"
    ];

    let s = satir;

    if(dis.some(k=>s.includes(k))) return "DIÅž TASARIM & DONANIM";
    if(ic.some(k=>s.includes(k))) return "Ä°Ã‡ TASARIM & KONFOR";
    if(guvenlik.some(k=>s.includes(k))) return "GÃœVENLÄ°K DONANIM";
    if(surus.some(k=>s.includes(k))) return "SÃœRÃœÅž ASÄ°STAN & TEKNOLOJÄ°";
    if(teknoloji.some(k=>s.includes(k))) return "EKSTRA DONANIM";

    return "EKSTRA DONANIM";
}

/* Ã–ZELLÄ°KLERÄ° HTMLâ€™E BAS */
let dragItem = null;

function ozellikleriBas(metin){

    let gruplar = {};

    metin.split("\n")
        .map(s=>buyukTR(s.trim()))
        .filter(Boolean)
        .forEach(s=>{
            let g = gruplandir(s);
            if(!gruplar[g]) gruplar[g]=[];
            gruplar[g].push(s);
        });

    let html = "";

    Object.keys(gruplar).forEach(grup=>{

        html += `
        <div class="kategori" ondragover="event.preventDefault()" ondrop="dropKategori('${grup}', event)">
            <div class="kategori-baslik">${grup}</div>
            <div id="kat_${grup}">
        `;

        gruplar[grup].forEach(item=>{
            html += `
            <div class="ozellik-item"
                 draggable="true"
                 ondragstart="dragStart(this)"
                 ondragend="dragEnd()">
                ${item}
            </div>
            `;
        });

        html += `</div></div>`;
    });

    return html;
}


/* CANLI */
function canli(){
    baslik.innerText = buyukTR(baslikInput.value);
    ozellikler.innerHTML = ozellikleriBas(ozellikInput.value);
    eksper.innerHTML = buyukTR(
        eksperInput.value.split("\n").filter(Boolean).join("<br>")
    );
}

/* RESÄ°M YÃœKLE + KAYIT */
function resmiYukle(){

    const ilan = document.getElementById("ilan");
    const hedefGenislik = 1080;
    const scale = hedefGenislik / ilan.offsetWidth;

    alert("YÃ¼kleme baÅŸladÄ±...");

    html2canvas(ilan,{
        scale,
        useCORS:true,
        backgroundColor:"#fff"
    }).then(canvas=>{

        canvas.toBlob(blob=>{

            let fd = new FormData();
            fd.append("file", blob);
            fd.append("upload_preset", UPLOAD_PRESET);
            fd.append("folder", "ilanlar");

            fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,{
                method:"POST",
                body:fd
            })
            .then(r=>r.json())
            .then(d=>{
                if(!d.secure_url){ alert("Hata"); return; }

                sonGorsel = d.secure_url;
                sonLink.value = d.secure_url;
                kaydet();
                window.open(d.secure_url,"_blank");
            });

        },"image/jpeg",0.92);
    });
}

/* KAYDET */
function kaydet(){

    let ilan = {
        id:Date.now(),
        baslik: buyukTR(baslikInput.value),
        ozellik: buyukTR(ozellikInput.value),
        eksper: buyukTR(eksperInput.value),
        gorsel: sonGorsel
    };

    let liste = JSON.parse(localStorage.getItem("cio_ilanlar")||"[]");
    liste.unshift(ilan);
    localStorage.setItem("cio_ilanlar",JSON.stringify(liste));
    listele();
}

/* LÄ°STE */
function listele(){
    let arama = buyukTR(aramaInput.value || "");
    let liste = JSON.parse(localStorage.getItem("cio_ilanlar")||"[]");
    let alan = document.getElementById("liste");
    alan.innerHTML = "";

    liste
    .filter(i => i.baslik.includes(arama))
    .forEach((i,index)=>{
        let d = document.createElement("div");
        d.className="kayit";
        d.innerText=i.baslik;
        d.onclick=()=>yukle(i);
        d.oncontextmenu=e=>{
            e.preventDefault();
            if(confirm("Silinsin mi?")) sil(index);
        };
        alan.appendChild(d);
    });
}

function sil(i){
    let l = JSON.parse(localStorage.getItem("cio_ilanlar"));
    l.splice(i,1);
    localStorage.setItem("cio_ilanlar",JSON.stringify(l));
    listele();
}

function yukle(i){
    baslikInput.value=i.baslik;
    ozellikInput.value=i.ozellik;
    eksperInput.value=i.eksper;
    sonLink.value=i.gorsel;
    sonGorsel=i.gorsel;
    canli();
}

listele();

function dragStart(el){
    dragItem = el;
    el.classList.add("dragging");
}

function dragEnd(){
    if(dragItem) dragItem.classList.remove("dragging");
    dragItem = null;
}

function dropKategori(grup, e){
    e.preventDefault();
    const hedef = e.currentTarget.querySelector("div[id^='kat_']");
    if(dragItem && hedef){
        hedef.appendChild(dragItem);
    }
}

</script>

</body>
</html>
